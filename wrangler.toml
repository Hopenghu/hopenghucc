name = "hopenghucc"
# Update main back to the single build output file
main = "dist/worker.js"
compatibility_date = "2024-04-14"
compatibility_flags = ["nodejs_compat"]

[build]
command = "npx esbuild src/worker.js --bundle --format=esm --outfile=dist/worker.js --target=node16 --platform=node --loader:.js=jsx --loader:.css=text"
# watch_dir = "src" # Consider if watch_dir needs update if we output to public

# D1 database for dynamic functionality
[[d1_databases]]
binding = "DB"
database_name = "hopenghucc_db"
database_id = "c2b675cd-af9c-4da9-b35c-aa7fb7f35344"

# Static site configuration removed - using embedded HTML
# [site]
# bucket = "./static-site/v2"

[observability.logs]
enabled = true 

# Custom domain routes
[[routes]]
pattern = "hopenghu.cc/*"
zone_name = "hopenghu.cc"

[[routes]]
pattern = "www.hopenghu.cc/*"
zone_name = "hopenghu.cc"

# Environment variables
# Note: Sensitive keys should be set via Cloudflare Workers secrets or environment variables
# Use: wrangler secret put <KEY_NAME>
# Example: wrangler secret put GOOGLE_MAPS_API_KEY
[vars]
# GOOGLE_MAPS_API_KEY - Set via Cloudflare Workers secrets
# GOOGLE_CLIENT_ID - Set via Cloudflare Workers secrets
# GOOGLE_CLIENT_SECRET - Set via Cloudflare Workers secrets
GOOGLE_REDIRECT_URI = "https://www.hopenghu.cc/api/auth/google/callback"
# JWT_SECRET - Set via Cloudflare Workers secrets
# OPENAI_API_KEY - Set via Cloudflare Workers secrets
# GEMINI_API_KEY - Set via Cloudflare Workers secrets