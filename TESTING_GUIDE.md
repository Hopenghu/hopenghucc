# 網站功能測試指南

根據截圖中的對話，以下是系統化的測試方法來驗證網站功能建置狀態。

## 🔍 從截圖發現的問題

### 問題 1：問問題流程沒有觸發
- **現象**：用戶說「我是商家」，但 AI 沒有主動問商家資訊
- **原因**：系統只檢查資料庫中的 `user_type` 和 `is_merchant`，沒有從對話中識別
- **已修復**：✅ 已改進 `determineUserType` 方法，現在可以從對話中識別「我是商家」

### 問題 2：Google Maps 查找功能缺失
- **現象**：用戶問「你能從 google map 找到 hasento INN 黑山頭嗎？」，AI 只說資料庫中沒有
- **原因**：目前只有 Distance Matrix API（計算距離），沒有 Places API（查找地點）
- **狀態**：⚠️ 需要實作 Google Places API 來查找地點資訊

## 📋 測試清單

### 測試 1：基本 AI 聊天功能 ✅

**測試步驟：**
1. 打開 AI 聊天頁面（`/ai-chat`）
2. 發送簡單訊息：「你好」
3. 觀察 AI 是否回應

**預期結果：**
- ✅ AI 應該回應問候語
- ✅ 介面正常顯示對話泡泡

**驗證項目：**
- `AIChatPage.js` 正常載入
- `src/api/ai.js` 路由正常
- `AIService.js` 可以與 AI 模型通訊

---

### 測試 2：使用者類型識別和問問題流程 🔄

**測試步驟：**

#### 2.1 商家身份識別
1. 登入（或未登入也可以）
2. 發送：「我是商家」
3. 觀察 AI 是否開始問問題

**預期結果：**
- ✅ AI 應該識別使用者為商家
- ✅ AI 應該開始問問題：「請問您要提供資訊的商家名稱是什麼？」
- ✅ 如果使用者已 claim 地點，應該自動使用該地點

**驗證項目：**
- `determineUserType` 方法正確識別
- `analyzeQuery` 方法觸發問問題流程
- `generateMerchantQuestion` 生成正確的問題

#### 2.2 商家問問題完整流程
1. 說「我是商家」
2. 回答 AI 的問題：
   - 商家名稱：「黑山頭 Hasento Inn」
   - 商家類型：「民宿」
   - 營業時間：「全年營業」
   - 產品名稱：「住宿服務」
   - 價格：「2000 元/晚」
   - 消費時間：「1 晚」
3. 觀察資訊是否儲存

**預期結果：**
- ✅ AI 按照流程問問題
- ✅ 資訊正確提取（價格、時間等）
- ✅ 資訊儲存到 `merchant_products` 表

**驗證項目：**
- 對話狀態正確追蹤（`ai_conversation_states`）
- 資訊正確提取（`extractStructuredInfo`）
- 資料正確儲存（`saveMerchantProduct`）

#### 2.3 旅客身份識別
1. 未登入或登入但未 claim 地點
2. 發送：「我想分享回憶」
3. 觀察 AI 是否開始問問題

**預期結果：**
- ✅ AI 識別使用者為旅客
- ✅ AI 開始問問題：「您想分享哪個地點的回憶？」

---

### 測試 3：資料庫查詢功能 ✅

**測試步驟：**

#### 3.1 查詢已知地點（成功案例）
1. 詢問一個**確定在資料庫中**的地點
   - 例如：「你有天后宮的資訊嗎？」
   - 或：「澎湖有什麼景點？」
2. 觀察 AI 回答

**預期結果：**
- ✅ AI 從資料庫查詢地點資訊
- ✅ 回答包含地點的詳細資訊（地址、電話、評分等）
- ✅ 回答明確標示「根據資料庫中的資訊...」

**驗證項目：**
- `getLocationContext` 正確查詢資料庫
- AI 正確使用資料庫資訊回答
- 沒有編造地點資訊

#### 3.2 查詢未知地點（失敗案例）
1. 詢問一個**確定不在資料庫中**的地點
   - 例如：「你有黑山頭 Hasento Inn 的資訊嗎？」
2. 觀察 AI 回答

**預期結果：**
- ✅ AI 明確說明「資料庫中沒有相關資訊」
- ✅ **不會編造**地點資訊
- ✅ 不會推薦錯誤的地點（如台南的赤崁樓）

**驗證項目：**
- 提示詞工程有效（禁止編造）
- 地理資訊驗證有效

---

### 測試 4：Google Maps 整合 ⚠️

**測試步驟：**

#### 4.1 距離查詢（Distance Matrix API）
1. 確保資料庫中有至少兩個地點
2. 詢問距離：
   - 「從天后宮到機場的距離」
   - 「從 A 到 B 要多久？」
   - 「A 和 B 之間的距離是多少？」
3. 觀察 AI 回答

**預期結果：**
- ✅ AI 識別距離查詢
- ✅ 呼叫 Google Maps Distance Matrix API
- ✅ 回答包含距離和時間
- ✅ 距離資訊快取到 `location_distances` 表

**驗證項目：**
- `DistanceService.calculateDistanceFromQuery` 正確識別
- Distance Matrix API 正常呼叫
- 距離資訊正確快取

#### 4.2 地點查找（Places API）❌ **尚未實作**
1. 詢問一個不在資料庫中但存在於 Google Maps 的地點
   - 「你能從 Google Maps 找到黑山頭 Hasento Inn 嗎？」
2. 觀察 AI 回答

**預期結果（目前）：**
- ⚠️ AI 只會說「資料庫中沒有資訊」
- ⚠️ **不會**從 Google Maps 查找

**未來需要實作：**
- Google Places API 整合
- 地點查找邏輯
- 將找到的地點資訊儲存到資料庫

---

### 測試 5：固定資訊查詢 🔄

**測試步驟：**

#### 5.1 產品資訊查詢
1. 先透過問問題流程建立商家產品資訊
2. 詢問：「[商家名稱] 的產品有哪些？」
3. 觀察 AI 回答

**預期結果（未來）：**
- ✅ AI 從 `merchant_products` 表查詢
- ✅ 回答包含產品名稱、價格、消費時間

**目前狀態：**
- ⚠️ 需要實作查詢邏輯（階段 3）

#### 5.2 營業時間查詢
1. 先透過問問題流程建立商家營業時間
2. 詢問：「[商家名稱] 的營業時間是？」
3. 觀察 AI 回答

**預期結果（未來）：**
- ✅ AI 從 `locations.opening_hours` 查詢
- ✅ 回答包含營業時間

**目前狀態：**
- ⚠️ 需要實作查詢邏輯（階段 3）

---

### 測試 6：登入狀態功能 ✅

**測試步驟：**
1. 登入網站
2. 打開 AI 聊天頁面
3. 觀察底部狀態訊息

**預期結果：**
- ✅ 顯示「已登入-您可以查詢資訊,也可以提供新資訊」
- ✅ 顯示使用者頭像和「足跡」

**驗證項目：**
- 前端正確顯示登入狀態
- 使用者資訊正確傳遞到後端

---

## 🐛 已知問題和解決方案

### 問題 1：問問題流程沒有觸發
- **狀態**：✅ 已修復
- **修復內容**：
  - 改進 `determineUserType` 方法，可以從對話中識別「我是商家」
  - 改進 `analyzeQuery` 方法，當用戶說「我是商家」時觸發問問題流程

### 問題 2：Google Maps 查找功能缺失
- **狀態**：⚠️ 需要實作
- **解決方案**：
  1. 啟用 Google Places API
  2. 實作地點查找邏輯
  3. 將找到的地點資訊儲存到資料庫

### 問題 3：固定資訊查詢未實作
- **狀態**：⚠️ 階段 3 任務
- **解決方案**：
  1. 實作產品資訊查詢
  2. 實作營業時間查詢
  3. 整合到 AI 回答中

---

## 📊 測試結果記錄表

| 測試項目 | 狀態 | 備註 |
|---------|------|------|
| 基本 AI 聊天 | ⬜ 待測試 | |
| 商家身份識別 | ⬜ 待測試 | 已修復，需重新測試 |
| 商家問問題流程 | ⬜ 待測試 | |
| 旅客問問題流程 | ⬜ 待測試 | |
| 資料庫查詢（已知地點） | ⬜ 待測試 | |
| 資料庫查詢（未知地點） | ⬜ 待測試 | |
| 距離查詢 | ⬜ 待測試 | |
| Google Maps 查找 | ❌ 未實作 | 需要 Places API |
| 產品資訊查詢 | ⚠️ 未實作 | 階段 3 |
| 營業時間查詢 | ⚠️ 未實作 | 階段 3 |
| 登入狀態顯示 | ⬜ 待測試 | |

---

## 🚀 立即測試建議

### 優先測試（驗證修復）
1. **測試商家身份識別**
   - 說「我是商家」
   - 確認 AI 開始問問題

2. **測試問問題流程**
   - 完成商家問問題流程
   - 確認資訊正確儲存

3. **測試距離查詢**
   - 詢問兩個地點之間的距離
   - 確認 AI 計算並回答

### 次要測試（驗證現有功能）
1. **測試資料庫查詢**
   - 查詢已知地點
   - 查詢未知地點
   - 確認沒有編造資訊

2. **測試旅客流程**
   - 說「我想分享回憶」
   - 完成問問題流程

---

## 📝 測試後回報

測試完成後，請回報：
1. 哪些功能正常運作
2. 哪些功能有問題
3. 需要改進的地方
4. 新的需求或想法

這樣可以幫助我們持續改進系統！
